# ユーザーガイド - 詳細な使い方

## 目次

- [はじめに](#はじめに)
- [試合の準備](#試合の準備)
- [試合の運用](#試合の運用)
- [各機能の詳細説明](#各機能の詳細説明)
- [ベストプラクティス](#ベストプラクティス)
- [OBS設定のTips](#obs設定のtips)

## はじめに

このガイドでは、野球中継スコアボードを実際の試合で使用する際の詳細な手順とTipsを説明します。

### 前提条件

- アプリケーションがインストール済みであること（Electron版またはWeb版）
- OBSなどの配信ソフトウェアがセットアップ済みであること

## 試合の準備

### 1. 設定ファイルの準備

試合開始前に、大会情報とチーム情報を設定します。

#### Electron版の場合

1. アプリを起動
2. メニューバー → `ファイル > 設定` （または `Ctrl/Cmd+,`）
3. 設定ウィンドウで以下を実施:
   - **YAMLファイルを選択**: 大会情報が記載されたYAMLファイルを選択
   - **設定ファイルを生成**: `✅ 設定ファイルを生成` ボタンをクリック
   - **試合状態を削除**: `🗑️ 試合状態を削除` ボタンをクリック（新規大会の場合）
   - **設定を再読み込み**: `🔄 設定を再読み込み` ボタンをクリック

#### Web版の場合

1. YAMLファイルを作成（例: `config/my-tournament.yaml`）
   ```yaml
   game_title: 夏季大会2025
   last_inning: 9
   board_background_color: "#00ff00"
   team_names:
     - チームA
     - チームB
     - チームC
     - チームD
   ```

2. コマンドで設定ファイルを生成
   ```bash
   npm run init config/my-tournament.yaml
   ```

3. 既存の試合状態を削除（新規大会の場合）
   ```bash
   rm data/current_game.json
   ```

4. サーバーを再起動
   ```bash
   node server.js
   ```

### 2. OBSの設定

#### ブラウザソースの追加

1. OBSで「ソース」パネルの「+」ボタンをクリック
2. 「ブラウザ」を選択
3. 以下を設定:
   - **名前**: `スコアボード` など分かりやすい名前
   - **URL**:
     - Electron版: Board ウィンドウを直接キャプチャ（後述）
     - Web版: `http://localhost:8080/board.html` （マルチPCの場合はIPアドレスを指定）
   - **幅**: 1920
   - **高さ**: 1080
   - **カスタムCSS**: 空欄でOK
   - **ページが読み込まれたときブラウザの表示を更新**: チェックを入れる

4. 「OK」をクリック

#### クロマキー合成の設定

1. 追加したブラウザソースを右クリック → 「フィルタ」
2. 「エフェクトフィルタ」セクションで「+」ボタンをクリック
3. 「クロマキー」を選択
4. 以下を設定:
   - **キーカラータイプ**: 設定した背景色に応じて選択
     - グリーン（`#00ff00`）→ 緑
     - マゼンタ（`#ff00ff`、`#ff55ff`）→ マゼンタ
     - ブルー（`#0000ff`）→ 青
   - **類似性**: 初期値400のまま（必要に応じて調整）
   - **滑らかさ**: 初期値80のまま（必要に応じて調整）

5. 「閉じる」をクリック

#### Electron版でウィンドウキャプチャを使う場合

1. OBSで「ソース」→ 「+」 → 「ウィンドウキャプチャ」
2. ウィンドウに「Baseball Scoreboard - Board」を選択
3. 同様にクロマキーフィルタを追加

## 試合の運用

### 試合開始

1. 操作パネルを開く
   - Electron版: 自動的に開きます
   - Web版: `http://localhost:8080/operation.html` にアクセス

2. 接続状態を確認
   - ナビゲーションバーに `🟢 接続中` と表示されることを確認
   - マスター/スレーブ状態も確認（通常は `👑 マスター (操作可能)`）

3. 初期状態を確認
   - 大会名が正しく表示されているか
   - 先攻・後攻チーム名が正しいか
   - イニング数が正しいか

4. 試合開始前の設定
   - **イニング**: 「試合前」を選択（デフォルト）
   - **表/裏**: 「表」を選択
   - OBSのプレビューでスコアボードが正しく表示されることを確認

### イニング中の操作

#### 得点の追加

- **+ボタン**: 得点を1点追加
- **-ボタン**: 得点を1点減らす（誤入力時）
- 得点はリアルタイムで表示ボードに反映されます

#### BSO（ボール・ストライク・アウト）の操作

**ボールカウント:**
- `B+` / `B-` ボタンで増減
- `クリア` ボタンで0に戻す
- カウント範囲: 0-3

**ストライクカウント:**
- `S+` / `S-` ボタンで増減
- `クリア` ボタンで0に戻す
- カウント範囲: 0-2

**アウトカウント:**
- `O+` / `O-` ボタンで増減
- `クリア` ボタンで0に戻す
- カウント範囲: 0-2

**ヒント**: アウトが3つになったら、攻守交代ボタンを押す前に、次の打者のためにBSOをクリアしておくとスムーズです。

#### ランナーの管理

- **チェックボックス**: 各塁（一塁、二塁、三塁）にランナーがいる場合はチェック
- **自動更新**: チェックの変更は即座に表示ボードに反映されます

**よくある操作:**
- シングルヒット: 一塁にチェック
- ダブルヒット: 二塁にチェック
- ホームラン: すべてのランナーをクリア、得点を追加
- 盗塁: 元の塁のチェックを外し、次の塁にチェック

### 攻守交代

#### 通常の攻守交代（表→裏）

1. `⚾ 攻守交代` ボタンをクリック
2. 確認ダイアログが表示されます
3. `OK` をクリック
4. 以下が自動的に実行されます:
   - 表/裏が切り替わる
   - BSO・ランナーがクリアされる

#### イニング変更（裏→次の表）

1. `⚾ 攻守交代` ボタンをクリック
2. 確認ダイアログが表示されます
3. `OK` をクリック
4. 以下が自動的に実行されます:
   - イニングが1つ進む
   - 表に戻る
   - BSO・ランナーがクリアされる

### 試合終了

1. 最終イニングが終了したら、イニングセレクタで「試合終了」を選択
2. 最終スコアが表示ボードに表示されます
3. OBSで配信を継続する場合は、そのまま表示を維持できます

## 各機能の詳細説明

### ナビゲーションバー

#### 接続状態インジケーター

| 表示 | 意味 | 対処法 |
|------|------|--------|
| 🟢 **接続中** | 正常に接続されています | - |
| ⚪ **接続中...** | 初回接続を試みています | 数秒待ちます |
| 🟡 **再接続中... (N/10)** | 接続が切断され、再接続中 | 自動再接続を待ちます |
| 🔴 **切断 (再接続失敗)** | 再接続に失敗しました | サーバーの状態を確認し、ページをリロード |

#### マスター/スレーブ表示

| 表示 | 意味 | 操作可能か |
|------|------|-----------|
| 👑 **マスター (操作可能)** | あなたが操作権限を持っています | ✅ 可能 |
| 👁️ **スレーブ (閲覧専用)** | 他の人が操作中です | ❌ 不可 |

### マスター権限の解放

複数人で交代しながら操作する場合に便利です。

1. マスターユーザーが `🔓 マスター権限を解放` ボタンをクリック
2. 確認ダイアログで `OK` をクリック
3. 次に古いスレーブユーザーが自動的にマスターに昇格
4. 元マスターはスレーブに降格

**注意**: 権限を解放した元マスターは、すぐにマスターに戻ることはできません（意図しない切り替えを防止するため）。

### 試合のリセット

#### 🔄 試合初期化（同じチームで次の試合）

**用途**: 同じチーム同士で次の試合を始める場合

**リセットされる内容:**
- イニング → 試合前（0回）
- 得点 → 両チーム0点
- BSO・ランナー → すべてクリア

**維持される内容:**
- チーム名
- 大会名

**手順:**
1. `🔄 試合初期化` ボタンをクリック
2. 確認ダイアログで `OK` をクリック
3. 即座にリセットされます

#### 📋 新規大会で初期化

**用途**: 新しい大会を開始する場合、または異なるチームの試合を始める場合

**手順:**
1. 事前に新しい設定ファイル（`init_data.json`）を生成しておく
   - Electron版: 設定ウィンドウで生成
   - Web版: `npm run init` で生成
2. `📋 新規大会で初期化` ボタンをクリック
3. 確認ダイアログで `OK` をクリック
4. サーバーから新しい設定が読み込まれます

**読み込まれる内容:**
- 大会名
- チーム名（先攻・後攻）
- 最終イニング
- チーム選択肢

## ベストプラクティス

### 試合前

- [ ] 設定ファイルを事前に準備する
- [ ] OBSで表示ボードのプレビューを確認する
- [ ] クロマキー合成が正しく機能するか確認する
- [ ] 操作パネルの接続状態が「🟢 接続中」であることを確認
- [ ] マスター権限を持っていることを確認（👑マークがあるか）

### 試合中

- [ ] アウトが増えたらBSOをクリアする習慣をつける
- [ ] 攻守交代時にランナーがクリアされることを確認
- [ ] 得点を誤入力した場合は、すぐに「-」ボタンで修正
- [ ] 接続状態インジケーターを定期的に確認

### 複数人での運用

- [ ] 操作担当者を明確にする
- [ ] マスター権限を持つ人を試合前に決めておく
- [ ] 交代する場合は「マスター権限を解放」機能を使う
- [ ] スレーブユーザーは確認用として別の画面で開いておく

### トラブル時

- [ ] 接続が切れたら自動再接続を待つ（最大10回、約5分）
- [ ] 再接続に失敗したらブラウザをリロード（F5）
- [ ] サーバーが停止していないか確認
- [ ] マスター権限が他の人に移っていないか確認

## OBS設定のTips

### 背景色の選択

推奨色とその特徴:

| 色 | Hex値 | 特徴 |
|----|-------|------|
| グリーン | `#00ff00` | 最も一般的、クロマキーの精度が高い |
| マゼンタ | `#ff00ff` | ユニフォームと被りにくい |
| ブルー | `#0000ff` | グリーンの次に一般的 |

**選択基準:**
- **グリーン推奨**: 一般的な野球ユニフォームは緑を使わないため
- **マゼンタ**: 芝生やグリーンバックとの競合を避けたい場合
- **ブルー**: 青いユニフォームがある場合は避ける

### クロマキーの調整

**類似性（Similarity）の調整:**
- 初期値: 400
- 背景が少し残る場合: 値を上げる（500-600）
- スコアボードの一部が消える場合: 値を下げる（300-350）

**滑らかさ（Smoothness）の調整:**
- 初期値: 80
- エッジがギザギザの場合: 値を上げる（100-150）
- ぼやけすぎる場合: 値を下げる（50-70）

### ブラウザソースのキャッシュ問題

**症状**: 設定を変更しても表示ボードに反映されない

**対処法:**
1. ブラウザソースを右クリック → 「プロパティ」
2. 「ページが読み込まれたときブラウザの表示を更新」にチェック
3. 「OK」をクリック
4. ブラウザソースを一度非表示にして、再度表示する

### 複数シーンでの使用

同じスコアボードを複数のシーンで使用する場合:

1. スコアボードソースを1つ作成
2. 他のシーンでは「既存のソースを追加」で同じソースを追加
3. こうすることで、どのシーンでも同じスコアボードが表示されます

### レイアウトの調整

**スコアボードの位置・サイズ変更:**
- OBSのプレビュー画面でドラッグ＆ドロップ
- 右クリック → 「変換」→ 「画面に合わせる」で全画面表示
- 「変換」→ 「位置をリセット」で中央配置

**推奨配置:**
- 画面上部中央: 最も一般的
- 画面下部: スコアボードの上に映像を重ねる場合

## 関連ドキュメント

- [トラブルシューティング](TROUBLESHOOTING.md) - 問題が発生した場合
- [設定ファイルガイド](CONFIGURATION.md) - YAMLファイルの詳細
- [マルチPC環境構築](MULTI_PC_SETUP.md) - 複数PCでの運用方法
- [Master/Slave制御](MASTER_SLAVE_ARCHITECTURE.md) - 複数人での操作制御の詳細
