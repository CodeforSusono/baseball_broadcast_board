# 設定ファイルガイド - init_data.json の詳細

## 目次

- [概要](#概要)
- [設定ファイルの構造](#設定ファイルの構造)
- [設定方法](#設定方法)
- [YAMLファイルの作成](#yamlファイルの作成)
- [コマンドライン引数](#コマンドライン引数)
- [フィールド詳細](#フィールド詳細)
- [よくある設定例](#よくある設定例)
- [トラブルシューティング](#トラブルシューティング)

## 概要

`config/init_data.json` は、野球中継スコアボードの初期設定を定義するファイルです。大会名、参加チーム、イニング数、表示ボードの背景色などを設定できます。

このファイルは以下の3つの方法で生成できます：

1. **インタラクティブモード**（推奨）: 対話形式で入力
2. **YAMLファイルから生成**: 設定をYAML形式で記述
3. **コマンドライン引数**: 一行のコマンドで直接指定

## 設定ファイルの構造

### 基本構造

```json
{
  "game_title": "大会名",
  "team_top": "先攻チーム名",
  "team_bottom": "後攻チーム名",
  "game_array": ["試合前", 1, 2, 3, 4, 5, 6, 7, 8, 9, "試合終了"],
  "team_items": ["　", "チームA", "チームB", "チームC"],
  "last_inning": 9,
  "board_background_color": "#ff55ff"
}
```

### 各フィールドの役割

| フィールド | 型 | 必須 | 説明 |
|----------|----|----|------|
| `game_title` | string | ✅ | 大会・トーナメントの名前 |
| `team_top` | string | ✅ | 先攻チーム名（初期表示） |
| `team_bottom` | string | ✅ | 後攻チーム名（初期表示） |
| `game_array` | array | ✅ | イニング選択プルダウンの選択肢 |
| `team_items` | array | ✅ | チーム名選択プルダウンの選択肢 |
| `last_inning` | number | ✅ | 最終イニング（1-9） |
| `board_background_color` | string | ❌ | 表示ボードの背景色（hex形式、デフォルト: `#ff55ff`） |

## 設定方法

### 方法1: インタラクティブモード（推奨）

対話形式で入力する最も簡単な方法です。

```bash
npm run init
```

#### 実行例

```
大会名を入力してください [現在: 大会名]: 夏季大会2025
試合の最終イニングを入力してください [現在: 9]: 7
表示ボードの背景色を入力してください (hex形式、例: #00ff00) [現在: #ff55ff]: #00ff00
参加チーム名を入力してください [入力終了: enterのみ]:
  チーム 1: ドラゴンズ
  チーム 2: タイガース
  チーム 3: ジャイアンツ
  チーム 4: スワローズ
  チーム 5: ベイスターズ
  チーム 6: カープ
  チーム 7:

✓ 先攻チーム: ドラゴンズ
✓ 後攻チーム: タイガース
✓ init_data.json を生成しました
```

#### 入力のTips

- **大会名**: 配信画面に表示されるタイトル
- **最終イニング**: 通常は9、少年野球などでは7が一般的
- **背景色**: OBSでクロマキー合成する色（推奨: `#00ff00`グリーン、`#ff00ff`マゼンタ）
- **参加チーム**: 何も入力せずEnterで入力終了
- **data/current_game.json削除の確認**: 新しい大会の場合は`Y`を選択

### 方法2: YAMLファイルから生成

設定を再利用したい場合や、複数の大会設定を管理する場合に便利です。

#### ステップ1: YAMLファイルを作成

```bash
# サンプルファイルをコピー
cp config/config.yaml.example config/summer-tournament.yaml

# エディタで編集
nano config/summer-tournament.yaml
```

#### ステップ2: YAML内容を記述

```yaml
game_title: 夏季大会2025
last_inning: 7
board_background_color: "#00ff00"  # 省略可（デフォルト: #ff55ff）
team_names:
  - ドラゴンズ
  - タイガース
  - ジャイアンツ
  - スワローズ
  - ベイスターズ
  - カープ
```

#### ステップ3: 設定ファイルを生成

```bash
npm run init config/summer-tournament.yaml
```

#### Electron版での実行

1. 設定ウィンドウを開く（`ファイル > 設定` または `Ctrl/Cmd+,`）
2. `📁 YAMLファイルを選択` ボタンをクリック
3. YAMLファイルを選択
4. プレビュー内容を確認
5. `✅ 設定ファイルを生成` ボタンをクリック

### 方法3: コマンドライン引数

一行のコマンドで直接指定する方法です。

```bash
npm run init -- -t "夏季大会2025" -i 7 --teams "ドラゴンズ,タイガース,ジャイアンツ,スワローズ,ベイスターズ,カープ" --bg-color "#00ff00"
```

#### オプション一覧

| オプション | 短縮形 | 型 | 必須 | 説明 | デフォルト |
|----------|--------|----|----|------|-----------|
| `--title` | `-t` | string | ✅ | 大会名 | - |
| `--innings` | `-i` | number | ❌ | 最終イニング（1-9） | 9 |
| `--teams` | - | string | ✅ | 参加チーム（カンマ区切り、最低2チーム） | - |
| `--bg-color` | - | string | ❌ | 背景色（hex形式） | `#ff55ff` |
| `--help` | `-h` | - | - | ヘルプ表示 | - |

#### 例

```bash
# 基本的な設定
npm run init -- -t "秋季大会" --teams "チームA,チームB,チームC"

# 7イニング制で背景色をグリーンに
npm run init -- -t "少年野球大会" -i 7 --teams "A,B,C,D" --bg-color "#00ff00"

# ヘルプ表示
npm run init -- --help
```

## YAMLファイルの作成

### サンプルテンプレート

```yaml
# 大会情報
game_title: 大会名またはトーナメント名

# イニング設定（1-9、デフォルト: 9）
last_inning: 9

# 表示ボード背景色（OBSクロマキー用、省略可）
# 推奨値: #00ff00 (グリーン), #ff00ff (マゼンタ), #0000ff (ブルー)
board_background_color: "#ff55ff"

# 参加チーム（最低2チーム必要）
team_names:
  - チーム1
  - チーム2
  - チーム3
  - チーム4
```

### 注意事項

- **YAMLのインデント**: スペース2個でインデント（タブは使用不可）
- **文字列のクォート**: 特殊文字を含む場合はダブルクォートで囲む
- **カラーコード**: `#` で始まる場合は必ずダブルクォートで囲む（例: `"#00ff00"`）
- **チーム数**: 最低2チーム必要

## フィールド詳細

### game_title

**説明**: 操作パネルと表示ボードに表示される大会名・トーナメント名

**例**:
```json
"game_title": "2025年夏季高校野球選手権大会"
```

**Tips**:
- 長すぎる名前は表示が崩れる可能性があるため、簡潔にする
- 配信画面に表示されるため、視聴者に分かりやすい名前にする

### team_top / team_bottom

**説明**: 先攻チーム（team_top）と後攻チーム（team_bottom）の初期値

**例**:
```json
"team_top": "ドラゴンズ",
"team_bottom": "タイガース"
```

**Tips**:
- 試合開始時の初期表示に使用されます
- 操作パネルでチーム名を変更できます
- `team_items` の中から選択されます

### game_array

**説明**: イニング選択プルダウンの選択肢

**例（9イニング制）**:
```json
"game_array": ["試合前", 1, 2, 3, 4, 5, 6, 7, 8, 9, "試合終了"]
```

**例（7イニング制）**:
```json
"game_array": ["試合前", 1, 2, 3, 4, 5, 6, 7, "試合終了"]
```

**自動生成ルール**:
- 最初の要素: `"試合前"`
- 中間の要素: `1` から `last_inning` までの数値
- 最後の要素: `"試合終了"`

### team_items

**説明**: チーム名選択プルダウンの選択肢

**例**:
```json
"team_items": ["　", "ドラゴンズ", "タイガース", "ジャイアンツ", "スワローズ"]
```

**自動生成ルール**:
- 最初の要素: 全角スペース `"　"` （空欄選択用）
- 以降の要素: `team_names` の各チーム名

**Tips**:
- 最初の全角スペースは必須（空欄を選択可能にするため）
- 操作パネルでチーム名を切り替える際に使用されます

### last_inning

**説明**: 最終イニング（1-9の整数）

**例**:
```json
"last_inning": 9
```

**一般的な値**:
- `9`: 通常の野球（プロ野球、高校野球など）
- `7`: 少年野球、一部の草野球
- `6`: 軟式野球の一部ルール

**Tips**:
- この値に応じて `game_array` が自動生成されます
- 試合中に変更することはできません（変更する場合は設定ファイルを再生成）

### board_background_color

**説明**: 表示ボード（board.html）の背景色（OBSクロマキー合成用）

**形式**: hex形式のカラーコード（例: `#00ff00`）

**デフォルト値**: `#ff55ff` (マゼンタ)

**推奨値**:

| 色 | Hex値 | 用途 |
|----|-------|------|
| グリーン | `#00ff00` | 最も一般的、クロマキー精度が高い |
| マゼンタ | `#ff00ff` または `#ff55ff` | ユニフォームと被りにくい |
| ブルー | `#0000ff` | グリーンの次に一般的 |

**例**:
```json
"board_background_color": "#00ff00"
```

**Tips**:
- ユニフォームの色と被らない色を選ぶ
- 鮮やかな原色（彩度100%）がクロマキー合成に最適
- Electron版では設定ウィンドウでGUI変更可能

## よくある設定例

### 例1: プロ野球風（9イニング制）

```yaml
game_title: プロ野球オープン戦
last_inning: 9
board_background_color: "#00ff00"
team_names:
  - ジャイアンツ
  - タイガース
  - ドラゴンズ
  - ベイスターズ
  - スワローズ
  - カープ
  - ホークス
  - ライオンズ
  - イーグルス
  - マリーンズ
  - バファローズ
  - ファイターズ
```

### 例2: 少年野球（7イニング制）

```yaml
game_title: 第10回少年野球大会
last_inning: 7
board_background_color: "#ff00ff"
team_names:
  - 東ジュニア
  - 西ジュニア
  - 南ジュニア
  - 北ジュニア
  - 中央ジュニア
```

### 例3: トーナメント形式

```yaml
game_title: 夏季トーナメント決勝
last_inning: 9
board_background_color: "#00ff00"
team_names:
  - 優勝候補A
  - 優勝候補B
```

### 例4: 複数会場での大会

各会場ごとにYAMLファイルを作成します。

**config/venue-a.yaml**:
```yaml
game_title: 夏季大会 - A会場
last_inning: 9
board_background_color: "#00ff00"
team_names:
  - チームA1
  - チームA2
  - チームA3
  - チームA4
```

**config/venue-b.yaml**:
```yaml
game_title: 夏季大会 - B会場
last_inning: 9
board_background_color: "#ff00ff"
team_names:
  - チームB1
  - チームB2
  - チームB3
  - チームB4
```

会場ごとに生成:
```bash
npm run init config/venue-a.yaml
# または
npm run init config/venue-b.yaml
```

## トラブルシューティング

### 設定ファイルが生成されない

**症状**: `npm run init` を実行してもファイルが作成されない

**原因と対処法**:
1. **権限の問題**: `config/` ディレクトリへの書き込み権限を確認
   ```bash
   ls -ld config/
   chmod u+w config/
   ```

2. **YAMLパースエラー**: YAMLファイルの構文が間違っている
   - インデントがスペース2個か確認
   - カラーコードが `"#00ff00"` のようにクォートで囲まれているか確認

3. **必須フィールドの欠落**: `game_title` や `team_names` が欠けている
   - エラーメッセージを確認して修正

### 背景色が反映されない

**症状**: `board_background_color` を変更しても表示ボードの背景色が変わらない

**対処法**:

#### Web版の場合
1. サーバーを再起動
   ```bash
   # Ctrl+C でサーバーを停止
   node server.js
   ```

2. ブラウザのキャッシュをクリア
   - 表示ボード（board.html）でハードリロード（`Ctrl+Shift+R` または `Cmd+Shift+R`）

#### Electron版の場合
1. 設定ウィンドウで「🔄 設定を再読み込み」をクリック
2. Board ウィンドウをリロード（`Ctrl+R` または `Cmd+R`）

### チーム名が文字化けする

**症状**: 日本語のチーム名が正しく表示されない

**原因**: YAMLファイルの文字エンコーディングが UTF-8 でない

**対処法**:
1. YAMLファイルを UTF-8 で保存し直す
2. BOM（Byte Order Mark）なしで保存

**Linuxの場合**:
```bash
file -bi config/my-config.yaml  # エンコーディング確認
iconv -f SHIFT_JIS -t UTF-8 config/my-config.yaml > config/my-config-utf8.yaml  # 変換
```

### init_data.json が壊れた

**症状**: 設定ファイルを手動編集後、アプリが正しく動作しない

**対処法**:

1. **バックアップから復元**:
   ```bash
   cp config/init_data.json.bak config/init_data.json
   ```

2. **JSONの構文確認**:
   ```bash
   cat config/init_data.json | python3 -m json.tool
   ```

3. **再生成**:
   ```bash
   npm run init
   ```

### "data/current_game.json を削除しますか?"で迷う

**判断基準**:

| 状況 | 削除するか | 理由 |
|------|----------|------|
| 新しい大会を始める | **Y (削除)** | 古い試合データが残っていると混乱する |
| 設定だけ変更（試合は継続） | **N (削除しない)** | 現在の試合状況を保持 |
| 背景色だけ変更 | **N (削除しない)** | 試合データに影響しない |
| テスト中 | **Y (削除)** | クリーンな状態で開始 |

**Tips**: 削除後は元に戻せないため、重要な試合データは事前にバックアップを取る
```bash
cp data/current_game.json data/current_game_backup_$(date +%Y%m%d_%H%M%S).json
```

## 関連ドキュメント

- [ユーザーガイド](USER_GUIDE.md) - 基本的な使い方
- [Electron設定ウィンドウガイド](ELECTRON_SETTINGS.md) - GUI での設定方法
- [トラブルシューティング](TROUBLESHOOTING.md) - よくある問題と解決方法
